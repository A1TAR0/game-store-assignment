{% extends "base.html" %}

{% block title %}Games - Game Store{% endblock %}

{% block content %}
<h2>Game Catalog</h2>

<div class="row mb-4">
    <div class="col-md-6">
        <input type="text" id="searchInput" class="form-control" placeholder="Search games...">
    </div>
    <div class="col-md-3">
        <select id="genreFilter" class="form-select">
            <option value="">All Genres</option>
            <option value="Action">Action</option>
            <option value="RPG">RPG</option>
            <option value="Adventure">Adventure</option>
            <option value="Sports">Sports</option>
            <option value="Strategy">Strategy</option>
        </select>
    </div>
    <div class="col-md-3">
        <select id="platformFilter" class="form-select">
            <option value="">All Platforms</option>
            <option value="PC">PC</option>
            <option value="PlayStation">PlayStation</option>
            <option value="Xbox">Xbox</option>
            <option value="Switch">Switch</option>
        </select>
    </div>
</div>

<div class="row" id="gamesContainer">
    {% if games %}
        {% for game in games %}
        <div class="col-md-4 mb-4 game-card" 
             data-title="{{ game.title|lower }}"
             data-genres="{{ game.genre|join(',')|lower }}"
             data-platforms="{{ game.platform|join(',')|lower }}">
            <div class="card h-100">
                <img src="{{ game.image_url or 'https://via.placeholder.com/300x200' }}" 
                     class="card-img-top" alt="{{ game.title }}">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ game.title }}</h5>
                    <p class="card-text">{{ game.description[:100] }}...</p>
                    <div class="mt-auto">
                        <p class="card-text">
                            <strong class="text-success">Â£{{ "%.2f"|format(game.price) }}</strong>
                        </p>
                       <p class="card-text">
                            <small class="text-muted">
                                {% for genre in game.genre[:2] %}
                                    <span class="badge bg-secondary">{{ genre }}</span>
                                {% endfor %}
                                {% if game.review_count %}
                                    <span class="badge bg-info">{{ game.review_count }} review{{ 's' if game.review_count != 1 else '' }}</span>
                                {% endif %}
                            </small>
                        </p>
                        <a href="{{ url_for('games.game_detail', game_id=game.game_id) }}" 
                           class="btn btn-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>No games available. Add some games to get started!</p>
    {% endif %}
</div>

<script>
// Simple search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const genreFilter = document.getElementById('genreFilter');
    const platformFilter = document.getElementById('platformFilter');
    const gameCards = document.querySelectorAll('.game-card');
    
    function filterGames() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedGenre = genreFilter.value.toLowerCase();
        const selectedPlatform = platformFilter.value.toLowerCase();
        
        gameCards.forEach(card => {
            const title = card.dataset.title;
            const genres = card.dataset.genres;
            const platforms = card.dataset.platforms;
            
            const matchesSearch = title.includes(searchTerm);
            const matchesGenre = !selectedGenre || genres.includes(selectedGenre);
            const matchesPlatform = !selectedPlatform || platforms.includes(selectedPlatform);
            
            if (matchesSearch && matchesGenre && matchesPlatform) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    searchInput.addEventListener('input', filterGames);
    genreFilter.addEventListener('change', filterGames);
    platformFilter.addEventListener('change', filterGames);
});
</script>
{% endblock %}